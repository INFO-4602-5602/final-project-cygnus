<html>

<head>
	<title>Project 1: Zayo Opportunities</title>

	<!--Include CSS-->
  <link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/bmabey/pyLDAvis/files/ldavis.v1.0.0.css">
	<link href="interaction.css" rel="stylesheet">
	<!-- Latest compiled and minified Bootstrap CSS -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<!-- Theme CSS -->
	<!-- Theme From: https://startbootstrap.com/template-overviews/freelancer/ -->
	<link href="freelancer.css" rel="stylesheet">
	<!-- Custom Fonts -->
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>
	<link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic,900,900italic' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.13/css/jquery.dataTables.css">
	<!-- reference to Leaflet CSS -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<link rel="stylesheet" href="leaflet.awesome-markers.css">

	<!--Include JavaScript Files-->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.5.0/d3.min.js"></script>
	<!-- Latest compiled and minified JavaScript -->
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.13/js/jquery.dataTables.js"></script>
	<script src="vis1.js"></script>
	<!-- creates uStates. -->
	<script src="https://use.fontawesome.com/f78ead1096.js"></script>
	<!-- reference to Leaflet JavaScript -->
	<script src="https://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="leaflet.awesome-markers.js"></script>
	<script src="leaflet-heat.js"></script>
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/modules/heatmap.js"></script>
	<script src="https://code.highcharts.com/modules/treemap.js"></script>

	<link rel="stylesheet" href="MarkerCluster.css" />
	<link rel="stylesheet" href="MarkerCluster.Default.css" />
	<link rel="stylesheet" type="text/css" href="https://cdn.rawgit.com/bmabey/pyLDAvis/files/ldavis.v1.0.0.css">
	<script src="leaflet.markercluster-src.js"></script>
	<style>
		body { padding-top: 100px; }
		text.active {
  			fill: red;
		}
	</style>

	<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.8.0/bootstrap-slider.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/9.8.0/css/bootstrap-slider.min.css">
</head>

<body>
	<!-- Navigation Bar -->
	<nav id="mainNav" class="navbar navbar-default navbar-custom navbar-fixed-top">
		<div class="container">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header page-scroll">
				<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
					<span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
				</button>
				<a class="navbar-brand" href="#">
        			<img alt="Brand" src="images/CU_interlocked_500x483px.png" height="42" width="42" style="margin:-10px 0px 0px 0px">
      			</a>
				<a class="navbar-brand" href="#">Project 2: Visualizing Yelp</a>
			</div>

			<!-- Collect the nav links, forms, and other content for toggling -->
			<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
				<ul class="nav navbar-nav navbar-right">
					<li class="hidden">
						<a href="#"></a>
					</li>
					<li class="page-scroll">
						<a href="#partOne">Part One</a>
					</li>
					<li class="page-scroll">
						<a href="#partTwo">Part Two</a>
					</li>
					<li class="page-scroll">
						<a href="#partThree">Part Three</a>
					</li>
					<li class="page-scroll">
						<a href="#partFour">Part Four</a>
					</li>
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</div>
		<!-- /.container-fluid -->
	</nav>
	<div class='container'>

		<div id="partOne" class="row">
			<h2 style="text-align: center;">Part One</h2>
			<div class="form-group col-md-offset-5 col-md-3">
                <label for="sel1">Order:</label>
                <select class="form-control" id="order">
                    <option value="name">by Name</option>
  					<option value="count">by Review Count</option>
  					<option value="group">by Cluster</option>
                </select>
            </div>
			<div class="col-md-offset-1" id="matrix"> </div>

		</div>
		
		

		<div id="partTwo" class="row">
			<h2 style="text-align: center;">Part Two</h2>
			<div id="map" class="row" style="margin: auto"></div>
			<div class="row col-md-offset-5" style="padding-top: 20px;"> 
				<input id="days" type="text" data-slider-ticks="[0, 1, 2, 3, 4, 5, 6]" data-slider-ticks-snap-bounds="50" data-slider-ticks-labels='["Mon", "Tue", "Wed", "Thu", "Fri"]' data-slider-value="0"/> 
			</div>
		</div>

		<div id="partThree" class="row ">
			<h2 style="text-align: center;">Part Three</h2>
			<div class="col-md-offset-1" id="ldavis_el48181399471630638884064191800"></div>
			
		</div>

		<div id="partFour" class="row">
			<h2 style="text-align: center;"> Part Four</h2>
		</div>

		
	</div>



	<script>
		var shiftWindow = function() { scrollBy(0, -100) };
		if (location.hash) shiftWindow();
		window.addEventListener("hashchange", shiftWindow);

		$("#days").slider({
    		ticks: [0, 1, 2, 3, 4, 5, 6],
    		ticks_labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
    		ticks_snap_bounds: 50
		});

		var heat = null;
		var maxDayCheckin = 6864;
		var map = L.map('map', {
			preferCanvas: true
		}).setView([36.264, -94.579], 4);
		L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
			attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
		}).addTo(map);
		
		var pointListDays = [];
		var pointListMon = [];
		var pointListTue = [];
		var pointListWed = [];
		var pointListThu = [];
		var pointListFri = [];
		var pointListSat = [];
		var pointListSun = [];
		d3.csv("processedData/checkin.csv", function(data) {
			for (var i = 0; i < data.length; i++) {
				var obj = data[i];
				
				pointListMon.push([obj['latitude'], obj['longitude'], ( obj['Mon']/maxDayCheckin )]);
				pointListTue.push([obj['latitude'], obj['longitude'], ( obj['Tue']/maxDayCheckin )]);
				pointListWed.push([obj['latitude'], obj['longitude'], ( obj['Wed']/maxDayCheckin )]);
				pointListThu.push([obj['latitude'], obj['longitude'], ( obj['Thu']/maxDayCheckin )]);
				pointListFri.push([obj['latitude'], obj['longitude'], ( obj['Fri']/maxDayCheckin )]);
				pointListSat.push([obj['latitude'], obj['longitude'], ( obj['Sat']/maxDayCheckin )]);
				pointListSun.push([obj['latitude'], obj['longitude'], ( obj['Sun']/maxDayCheckin )]);
				
				if (i === data.length - 1) {
					pointListDays.push(pointListMon);
					pointListDays.push(pointListTue);
					pointListDays.push(pointListWed);
					pointListDays.push(pointListThu);
					pointListDays.push(pointListFri);
					pointListDays.push(pointListSat);
					pointListDays.push(pointListSun);
					heat = L.heatLayer(pointListMon).addTo(map);
				}
			}
		});

		$("#days").on("change", function(e) {
			heat.setLatLngs(pointListDays[e.value.newValue]);
			//$("#ex6SliderVal").text(slideEvt.value);
		});


		// Co-Occurence Matrix

		var svgWidth = 1224;
        var svgHeight = 1224;
        var xOffset = 50;
        var yOffset = 50;
        var margin = 10;
        var width = svgWidth - ( xOffset * 2 ) - ( margin * 2 );
        var height = svgHeight - ( yOffset * 2 ) - ( margin * 2 );

        var svg = d3.select("#matrix").append("svg:svg")
                                    .attr("width", svgWidth)
                                    .attr("height", svgHeight);

        d3.json("processedData/force.json", function(miserables) {
  			var matrix = [],
      		nodes = miserables.nodes,
      		n = nodes.length;

  			// Compute index per node.
  			nodes.forEach(function(node, i) {
    			node.index = i;
    			matrix[i] = d3.range(n).map(function(j) { return {x: j, y: i, z: 0}; });
  			});

  			// Convert links to matrix
  			miserables.links.forEach(function(link) {
    			matrix[link.source][link.target].z += 1;
    			matrix[link.target][link.source].z += 1;
    
  			});


  		// Precompute the orders.
  		var orders = {
    		name: d3.range(n).sort(function(a, b) { return d3.ascending(nodes[a].name, nodes[b].name); }),
    		count: d3.range(n).sort(function(a, b) { return nodes[b].count - nodes[a].count; }),
    		group: d3.range(n).sort(function(a, b) { return nodes[b].group - nodes[a].group; })
  		};

  		// The default sort order.
  		

  		var x = d3.scaleBand();
  		var z = d3.scaleLinear().domain([0, 1]).clamp(true);
    	var c = d3.scaleOrdinal(d3.schemeCategory10).domain([2,5]);
  		x.domain(orders.name).range([yOffset + margin, svgHeight - margin - yOffset]);
  		svg.append("rect")
      		.attr("fill", "#eee")
      		.attr("x", xOffset + margin)
      		.attr("y", yOffset + margin)
      		.attr("width", width)
      		.attr("height", height);

      	var row = svg.selectAll(".row")
      		.data(matrix)
    		.enter().append("g")
      			.attr("class", "row")
      			.each(row);
      			

      	row.append("line")
      		.attr("x1", xOffset + margin)
      		.attr("y1", function(d, i) {
      			return x(i); })
      		.attr("x2", xOffset + margin + width)
      		.attr("y2", function(d, i) { 
      			return x(i); })
      		.attr("stroke-width", 0.5)
	        .attr("stroke", "white");

      	row.append("text")
      		.attr("x", xOffset + margin / 2)
      		.attr("y", function(d, i) { return x(i) + x.bandwidth() / 2; })
      		.attr("dy", ".32em")
      		.attr("text-anchor", "end")
      		.style("font-size","14px")
      		.text(function(d, i) { return nodes[i].name; });

		

		var column = svg.selectAll(".column")
      		.data(matrix)
    		.enter().append("g")
      			.attr("class", "column");

  		column.append("line")
      		.attr("x1", function(d, i) { return x(i); })
      		.attr("y1", xOffset + margin)
      		.attr("x2", function(d, i) { return x(i); })
      		.attr("y2", xOffset + margin + height)
      		.attr("stroke-width", 0.5)
	        .attr("stroke", "white");

  		column.append("text")
  			.attr("class", "text1")
  			.attr("transform", "rotate(-90)")
      		.attr("x", -(xOffset + margin / 2) )
      		.attr("y", function(d, i) { return x(i) + x.bandwidth() / 2; })
      		.attr("dy", ".32em")
       		.attr("text-anchor", "start")
      		.style("font-size","14px")
      		.text(function(d, i) { return nodes[i].name; });
      	

      	column.append("text")
      		.attr("class", "text2")
  			.attr("transform", "rotate(-90)")
      		.attr("x", -(xOffset + margin * 1.5) - width )
      		.attr("y", function(d, i) { return x(i) + x.bandwidth() / 2; })
      		.attr("dy", ".32em")
       		.attr("text-anchor", "end")
      		.style("font-size","14px")
      		.text(function(d, i) { return nodes[i].name; });

      	function row(row) {
    		var cell = d3.select(this).selectAll(".cell")
        				.data(row.filter(function(d) { return d.z; }))
      				.enter().append("rect")
        				.attr("class", "cell")
        				.attr("x", function(d) { return x(d.x); })
        				.attr("y", function(d) { return x(d.y); })
        				.attr("width", x.bandwidth())
        				.attr("height", x.bandwidth())
        				.style("fill-opacity", function(d) { return z(d.z); })
        				.style("fill", function(d) { return nodes[d.x].group == nodes[d.y].group ? c(nodes[d.x].group) : 'gray'; })
        				.on("mouseover", mouseover)
        				.on("mouseout", mouseout);
  		}

  		function mouseover(p) {
    		d3.selectAll(".row text").classed("active", function(d, i) { return i == p.y; });
    		d3.selectAll(".column .text1").classed("active", function(d, i) { return i == p.x; });
    		d3.selectAll(".column .text2").classed("active", function(d, i) { return i == p.x; });
  		}

  		function mouseout() {
    		d3.selectAll("text").classed("active", false);
  		}

  		d3.select("#order").on("change", function() {
    		order(this.value);
  		});

  		function order(value) {
    		x.domain(orders[value]);


    		var t = svg.transition().duration(2500);

    		t.selectAll(".row text")
        		.delay(function(d, i) { return x(i) * 4; })
        		.attr("x", xOffset + margin / 2)
      			.attr("y", function(d, i) { return x(i) + x.bandwidth() / 2; });
      		t.selectAll(".row line")
      		 	.delay(function(d, i) { return x(i) * 4; })
      		 	.attr("x1", xOffset + margin)
      			.attr("y1", function(d, i) {
      			return x(i); })
      			.attr("x2", xOffset + margin + width)
      			.attr("y2", function(d, i) { 
      			return x(i); });
      		t.selectAll(".cell")
        		.delay(function(d) { return x(d.x) * 4; })
        		.attr("x", function(d) { return x(d.x); })
        		.attr("y", function(d) { return x(d.y); });

    		t.selectAll(".column line")
        		.delay(function(d, i) { return x(i) * 4; })
        		.attr("x1", function(d, i) { return x(i); })
      			.attr("y1", xOffset + margin)
      			.attr("x2", function(d, i) { return x(i); })
      			.attr("y2", xOffset + margin + height);
      		t.selectAll(".column .text1")
        		.delay(function(d, i) { return x(i) * 4; })
        		.attr("x", -(xOffset + margin / 2) )
      			.attr("y", function(d, i) { return x(i) + x.bandwidth() / 2; });
      		t.selectAll(".column .text2")
        		.delay(function(d, i) { return x(i) * 4; })
        		.attr("x", -(xOffset + margin * 1.5) - width )
      			.attr("y", function(d, i) { return x(i) + x.bandwidth() / 2; });
  		}

      	});
	</script>

</body>
